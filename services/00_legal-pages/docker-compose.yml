name: legal-pages

# Pages légales pour WhatsApp Business et services
# Next.js avec formulaires (contact, réclamation, suppression RGPD)

services:
  legal-pages:
    build:
      context: ./legal-app
      dockerfile: Dockerfile
    container_name: legal-pages
    restart: unless-stopped

    environment:
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1
      - RESEND_API_KEY=${RESEND_API_KEY}
      - ADMIN_EMAIL=${ADMIN_EMAIL:-yanis.amine.harrat@gmail.com}
      - FROM_EMAIL=${FROM_EMAIL:-legal@blackrise.io}

    networks:
      - home-labs

    # Sécurité
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL

    # Limites de ressources
    mem_limit: 256m
    cpus: "0.25"

    # Rotation des logs
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

    # Healthcheck
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:3000/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

networks:
  home-labs:
    external: true
